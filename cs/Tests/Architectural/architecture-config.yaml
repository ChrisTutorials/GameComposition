# Cross-Plugin Architecture Configuration
# This file defines architectural rules and allowed exceptions for cross-plugin validation

# Allowed cross-domain dependencies (Source -> Target)
# Format: "SourceDomain->TargetDomain"
allowed_cross_domain_dependencies:
  # Input flow dependencies
  - "Input->Targeting"
  - "Input->Grid"
  
  # Targeting flow dependencies  
  - "Targeting->Manipulation"
  - "Targeting->Grid"
  
  # Manipulation flow dependencies
  - "Manipulation->Placement"
  - "Manipulation->Grid"
  
  # Cursor flow dependencies
  - "Cursor->Targeting"
  - "Cursor->Grid"
  - "Cursor->Placement"

# Allowed namespace violations (for legacy compatibility)
allowed_namespace_violations:
  - "Legacy.*"
  - "Internal.*"

# Required service interfaces
required_service_interfaces:
  - "IService"
  - "I*Service"

# Domain patterns for auto-discovery
domain_patterns:
  - "Targeting"
  - "Manipulation" 
  - "Cursor"
  - "Grid"
  - "Input"

# Service patterns for auto-discovery
service_patterns:
  - "*Service"
  - "*Service"
  - "*Adapter"
  - "*Workflow"
  - "*Orchestrator"

# State patterns for auto-discovery
state_patterns:
  - "*State"
  - "*Snapshot"
  - "*Context"
  - "*Data"
  - "*ViewModel"

# Event patterns for auto-discovery
event_patterns:
  - "*Event"
  - "*EventArgs"

# Adapter patterns for auto-discovery
adapter_patterns:
  - "*Adapter"
  - "Godot*"

# Presenter patterns for auto-discovery
presenter_patterns:
  - "*Presenter"

# ViewModel patterns for auto-discovery
viewmodel_patterns:
  - "*ViewModel"

# Orchestrator patterns for auto-discovery
orchestrator_patterns:
  - "*Orchestrator"
  - "*Workflow"

# Assembly discovery patterns
assembly_discovery:
  include_patterns:
    - "*.Core.dll"
    - "GameComposition.*.dll"
    - "GridPlacement.*.dll"
  exclude_patterns:
    - "*.Tests.dll"
    - "*.Tools.dll"
    - "Microsoft.*.dll"
    - "System.*.dll"

# Prohibited patterns (anti-patterns that should not exist)
prohibited_patterns:
  # Global event bus pattern - use IEventDispatcher injection instead
  global_event_bus:
    enabled: true
    pattern: "*GlobalEventBus"
    message: "GlobalEventBus pattern is prohibited. Use IEventDispatcher injection instead."
    allowed_domain_specific:
      - "PlacementEventBus"
      - "GridEventBus" 
      - "TargetingEventBus"
      - "InputEventBus"
    test_assemblies:
      - "GridPlacement.Core"
      - "GameComposition.Core"
  
  # Dictionary<string, object> for domain data - use strong typing instead
  weak_typing:
    enabled: true
    pattern: "Dictionary<string, object>"
    message: "Dictionary<string, object> is prohibited for domain data. Use strongly typed classes instead."
    allowed_contexts:
      - "UI.*"
      - "External.*"
    target_namespaces:
      - "*.Data.*"
      - "*.Contracts.*"
      - "*.DTO.*"
    name_patterns:
      - "*Entry"
      - "*Metadata"
      - "*Data"
      - "*Contract"
  
  # Custom implementations - use Microsoft.Extensions instead
  custom_implementations:
    enabled: true
    prohibited_names:
      - "CustomPool"
      - "CollectionPool"
      - "CustomLogger"
      - "CustomDI"
    message: "Custom implementations are prohibited. Use Microsoft.Extensions.* instead."
    target_assemblies:
      - "GameComposition.Core"
  
  # Engine dependencies in Core packages
  engine_dependencies:
    enabled: true
    prohibited_dependencies:
      - "Godot"
      - "Unity"
      - "Unreal"
    message: "Engine dependencies are prohibited in Core packages. Core must be engine-agnostic."
    target_assemblies:
      - "GameComposition.Core"
      - "GridPlacement.Core"
    allowed_exceptions:
      - "Tests"
      - "Examples"

# Event architecture rules
event_architecture:
  # Required: Event interfaces must live in Core
  interfaces_in_core:
    enabled: true
    core_namespaces:
      - "*.Core.*"
      - "BarkMoon.*.Core.*"
  
  # Required: Use IEventDispatcher injection
  dispatcher_injection:
    enabled: true
    allowed_interfaces:
      - "IEventDispatcher"
      - "IEventBus"

# Strong typing rules
strong_typing:
  # Prohibit object/object? in domain interfaces
  prohibit_object_typing:
    enabled: true
    target_interfaces:
      - "I*Service"
      - "I*Repository"
      - "I*Factory"
      - "I*Adapter"
    prohibited_types:
      - "object"
      - "object?"
    message: "Object typing is prohibited in service interfaces. Use strong types instead."
  
  # Require specific return types
  required_return_types:
    enabled: true
    interface_patterns:
      - "I*Service"
      - "I*Repository"
    prohibited_return_types:
      - "object"
      - "object?"
    message: "Service methods must return strong types, not object."

# Service-Based Architecture rules
service_based_architecture:
  # Required: Core/Godot separation
  core_godot_separation:
    enabled: true
    core_patterns:
      - "*.Core.*"
      - "BarkMoon.*.Core.*"
    godot_patterns:
      - "*.Godot.*"
      - "BarkMoon.*.Godot.*"
      - "*Adapter.cs"
  
  # Required: Adapters bridge Engine â†” Core
  adapter_pattern:
    enabled: true
    adapter_patterns:
      - "*Adapter"
      - "Godot*Adapter"
    bridge_direction: "EngineToCore"
  
  # Required: Services/Routers handle Core business logic
  service_pattern:
    enabled: true
    service_patterns:
      - "*Service"
      - "*Router"
      - "*Workflow"
      - "*Orchestrator"
    layer: "Core"

# Test configuration
test_configuration:
  parallel_execution: true
  fail_fast: false
  max_violations_per_test: 10
  
# Reporting configuration
reporting:
  include_suggestions: true
  group_by_domain: true
  severity_levels:
    - "Error"
    - "Warning" 
    - "Info"
